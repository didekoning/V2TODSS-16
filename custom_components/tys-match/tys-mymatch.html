<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<dom-module id="tys-mymatch">
    <template>
        <!-- <style include="app-grid-style">
:host {
display: inline-block;
width: 100%;
--app-grid-columns: 3;
--app-grid-item-height: 80px;
}
paper-card{width: 15%; opacity: 1; transition: 300ms;}
.name {
text-align: center;
}
</style> -->
        <div>
        <paper-card id=card1>
            <div class="basic"><span class="name"><p style="color:black;">{{fullname}}</p></span></div>
        </paper-card>
                    <paper-button data-id="{{item.partner}}" id="{{item.partner}}" on-tap="Delete">Verwijder match</paper-button>
        </div>
            <iron-ajax
                   id="getPerson"
                   url="{{url}}"
                   handle-as="json"
                   on-response="handleResponse">
        </iron-ajax>
        <iron-ajax
                   id="DeclineMatch"
                   method="put"
                   content-type="application/json"
                   url="https://api.tys-chat.nl/matching/status"
                   body='{"action": "decline", "partner": {{personId}}}'
                   handle-as="json">
        </iron-ajax>
        <iron-meta-query key="token" id="meta" value="{{idToken}}"></iron-meta-query>
    </template>
    <script>
        Polymer({	    
            is: 'tys-mymatch',
            properties: {
                url: {
                    type: String,
                },
                person: {
                    type: Object
                },
                fullname: {
                    type: String,
                    computed: 'computeFullName(person.voornaam, person.achternaam)'
                },
                idToken: {
                    type: String,
                    observer: '_getMatch'
                }
            },
            _getMatch: function () {
                if(this.idToken != undefined){
                    this.$.getPerson.headers['authorization'] = this.idToken;
                    this.$.getPerson.generateRequest();
                }
            },
            handleResponse: function (data) {
                this.person = data.detail.response;
            },
            computeFullName: function(firstName, lastName) {
                return firstName + ' ' + lastName;
            },
            Delete: function(e) {
                var button = Polymer.dom(e).localTarget;
                this.personId = button.id;
                this.$.DeclineMatch.headers['authorization'] = this.idToken;
                this.$.DeclineMatch.generateRequest();
                var card = this;
                card.style.marginLeft = "-100%";
                card.style.opacity = "0";
                setTimeout(function() {
                    card.remove();
                }, 500);
            }
        });
    </script>
</dom-module>