<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!--
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">
-->
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<dom-module id="my-preferences">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;

      }
      .disease{width: 49%; display: inline-block; margin-bottom: 20px;}
      .hobby{width: 49%; display: inline-block; margin-bottom: 20px;}
    </style>

    <div class="card">
      <h1>Voorkeuren instellen</h1>
        <form is="iron-form" id="form">
            <div class="disease"  mobile-layout$="[[isMobilePhone]]">
                <h2>Ziekte</h2>
                <paper-dropdown-menu label="Ziekte" id="ziekte">
                    <paper-listbox class="dropdown-content">
                         <template is="dom-repeat" items="{{ziektes}}">
                            <paper-item value="{{item.root}}" kenmerk="{{item.kenmerkID}}">{{item.naam}}</paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>
            </div>
                       
            <div class="hobby" mobile-layout$="[[isMobilePhone]]">
                <h2>Hobbies</h2>
                <paper-dropdown-menu label="Hobbies" id="hobby">
                    <paper-listbox class="dropdown-content">
                         <template is="dom-repeat" items="{{hobbies}}">
                            <paper-item value="{{item.root}}" kenmerk="{{item.kenmerkID}}">{{item.naam}}</paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>
            </div>
            <paper-button raised on-tap="addAttributes">Volgende stap</paper-button>
        </form>
    </div>
    <iron-meta-query key="token" id="meta" value="{{idToken}}"></iron-meta-query>

    <iron-ajax
       id="getZiektes"
       method="GET"
       url="https://api.tys-chat.nl/meta/kenmerken/0"
       handle-as="json"
       headers='{"Content-Type": "application/json;charset=utf-8"}' 
       content-type="application/json"
       on-response="handleZiekteResponse">
    </iron-ajax>
     <iron-ajax
       id="getHobbies"
       method="GET"
       url="https://api.tys-chat.nl/meta/kenmerken/3000"
       handle-as="json"
       headers='{"Content-Type": "application/json;charset=utf-8"}' 
       content-type="application/json"
       on-response="handleHobbiesResponse">
    </iron-ajax>
  </template>

  <script>
    Polymer({
       is: 'my-preferences',
       properties: {
            custom: {
                type: Object,
                notify: true,
            },
            idToken: {
                type: String,
                observer: 'fillLists',
            },
            ziektes: {
                type: Array,
            },
            hobbies: {
                type: Array,
            },
            kenmerken: {
              type: Array,
              value: {
                type: Object,
              },
            },
            selectedItems: {
              type: Object,
              value: {},
            }
        },
        handleZiekteResponse: function(data){
            this.ziektes = data.detail.response;
        },
        handleHobbiesResponse: function(data){
            this.hobbies = data.detail.response;
        },
        fillLists: function(){
            if(this.idToken != undefined){
                this.$.getZiektes.headers['authorization'] = this.idToken;
                this.$.getHobbies.headers['authorization'] = this.idToken;
                this.$.getZiektes.generateRequest();
                this.$.getHobbies.generateRequest();

            }
        },
        addAttributes: function(){
          // console.log(this.$.ziekte.selectedItem.kenmerk);
          var ziekte = this.$.ziekte.selectedItem.kenmerk;
          this.kenmerken = [
          {"kenmerkID": this.$.ziekte.selectedItem.kenmerk, "root": this.$.ziekte.selectedItem.value },
          {"kenmerkID": this.$.hobby.selectedItem.kenmerk, "root": this.$.hobby.selectedItem.kenmerk }];
          console.log(JSON.stringify(this.kenmerken));
        },
    });
  </script>
</dom-module>
